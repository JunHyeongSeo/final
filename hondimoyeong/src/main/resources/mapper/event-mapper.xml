<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.kh.hondimoyeong.event.model.mapper.EventMapper">

	<resultMap type="event" id="eventResultSet">
		<result column="EVENT_NO" property="eventNo"/>
		<result column="EVENT_TITLE" property="eventTitle"/>
		<result column="EVENT_CONTENT" property="eventContent"/>
		<result column="CREATE_DATE" property="createDate"/>
		<result column="STATUS" property="status"/>
		<result column="USER_NO" property="userNo"/>
		<result column="COUNT" property="count"/>
		<result column="CHANGE_NAME" property="changeName"/>
	</resultMap>
	
	<resultMap type="eventImg" id="eventImgResultSet">
		<result column="EVENT_IMG_NO" property="eventImgNo"/>
		<result column="EVENT_NO" property="eventNo"/>
		<result column="ORIGIN_NAME" property="originName"/>
		<result column="CHANGE_NAME" property="changeName"/>
		<result column="FILE_LEVEL" property="fileLevel"/>
	</resultMap>


	<select id="selectListCount" resultType="_int">
		SELECT
		      COUNT(*)
		  FROM
		      EVENT
		 WHERE
		      STATUS = 'Y'
	</select>

	<select id="allEvents" resultMap="eventResultSet">
		SELECT
		      E.EVENT_NO,
		      EVENT_TITLE,
		      EVENT_CONTENT,
		      CREATE_DATE,
		      USER_NO,
		      COUNT,
		      CHANGE_NAME
		  FROM
		      EVENT E
		  LEFT
		  JOIN
		      EVENT_IMG EI ON (E.EVENT_NO = EI.EVENT_NO AND FILE_LEVEL = 1)
		 WHERE
		      STATUS = 'Y'
		 ORDER
		    BY
		      E.EVENT_NO DESC
	</select>
	
	<select id="selectEvent" parameterType="_int" resultMap="eventResultSet">
		SELECT
		      E.EVENT_NO,
		      EVENT_TITLE,
		      EVENT_CONTENT,
		      CREATE_DATE,
		      COUNT,
		      CHANGE_NAME
		  FROM
		      EVENT E
		  LEFT
		  JOIN
		      EVENT_IMG EI ON (E.EVENT_NO = EI.EVENT_NO AND FILE_LEVEL = 2)
		 WHERE
		      STATUS = 'Y'
		   AND
		      E.EVENT_NO = #{eventNo}
		 ORDER
		    BY
		      E.EVENT_NO DESC
	</select>

	<select id="selectEventImg" resultMap="eventImgResultSet">
	SELECT
	      EVENT_NO,
	      ORIGIN_NAME,
	      CHANGE_NAME
	  FROM
	      EVENT_IMG
	</select>
	
	<update id="increaseCount" parameterType="_int">
		UPDATE
			  EVENT
		   SET
		   	  COUNT = COUNT + 1
		 WHERE
		 	  EVENT_NO = #{eventNo}
		   AND
		   	  STATUS = 'Y'
	</update>

</mapper>