<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="companionMapper">

<resultMap type="companion" id="companionResultSet">
	<result column="ACCOMPANY_NO" property="companionNo"/>
	<result column="USER_NO" property="userNo"/>
	<result column="USER_NAME" property="userName"/>
	<result column="COURSE_NO" property="courseName"/>
	<result column="ACCOMPANY_DATE" property="companionDate"/>
	<result column="WITH_TITLE" property="companionTitle"/>
	<result column="WITH_CONTENT" property="companionContent"/>
	<result column="CREATE_DATE" property="createDate"/>
	<result column="COUNT" property="count"/>
	<result column="A_STATUS" property="status"/>
	<result column="ACCOMPANY_PEOPLE" property="companionPeople"/>
	<result column="ACCOMPANY_NUM" property="companionNum"/>
</resultMap>

	<select id="selectListCount" resultType="_int">
		SELECT
		      COUNT(*)
		  FROM
		      ACCOMPANY
		 WHERE
			  STATUS = 'Y'
	</select>
	
	
	<select id="selectAll" resultMap="companionResultSet">
		SELECT
		      A.ACCOMPANY_NO AS ACCOMPANY_NO,
		      M.USER_NAME,
		      C.COURSE_NO AS COURSE_NO,
		      A.ACCOMPANY_DATE,
		      A.WITH_TITLE,
		      A.WITH_CONTENT,
		      TO_CHAR (A.CREATE_DATE, 'YY/MM/DD') AS CREATE_DATE,
		      A.COUNT,
		      A.STATUS AS STATUS,
		      A.ACCOMPANY_PEOPLE,
		      COUNT(B.USER_NO) AS ACCOMPANY_NUM
		  FROM
		      ACCOMPANY A
		  JOIN
		      COURSE C ON (A.COURSE_NO = C.COURSE_INDEX)
		  JOIN
		      MEMBER M USING (USER_NO)
		  LEFT
		  JOIN
		      ACCOMPANY_BRIDGE B ON (A.ACCOMPANY_NO = B.ACCOMPANY_NO)
		 WHERE
		      A.STATUS = 'Y'
		 GROUP
		    BY
		      A.ACCOMPANY_NO,
		      M.USER_NAME,
		      C.COURSE_NO,
		      A.ACCOMPANY_DATE,
		      A.WITH_TITLE,
		      A.WITH_CONTENT,
		      A.CREATE_DATE,
		      A.COUNT,
		      A.STATUS,
		      A.ACCOMPANY_PEOPLE
		ORDER
		   BY
		     A.ACCOMPANY_NO DESC
	</select>
	
	<select id="findCompanion" resultMap="companionResultSet">
		SELECT
		      A.ACCOMPANY_NO AS ACCOMPANY_NO,
		      M.USER_NAME,
		      C.COURSE_NO AS COURSE_NO,
		      A.ACCOMPANY_DATE,
		      A.WITH_TITLE,
		      A.WITH_CONTENT,
		      TO_CHAR (A.CREATE_DATE, 'YY/MM/DD') AS CREATE_DATE,
		      A.COUNT,
		      A.STATUS AS STATUS,
		      A.ACCOMPANY_PEOPLE,
		      COUNT(B.USER_NO) AS ACCOMPANY_NUM
		  FROM
		      ACCOMPANY A
		  JOIN
		      COURSE C ON (A.COURSE_NO = C.COURSE_INDEX)
		  JOIN
		      MEMBER M USING (USER_NO)
		  LEFT
		  JOIN
		      ACCOMPANY_BRIDGE B ON (A.ACCOMPANY_NO = B.ACCOMPANY_NO)
		 WHERE
		      A.STATUS = 'Y'
		 GROUP
		    BY
		      A.ACCOMPANY_NO,
		      M.USER_NAME,
		      C.COURSE_NO,
		      A.ACCOMPANY_DATE,
		      A.WITH_TITLE,
		      A.WITH_CONTENT,
		      A.CREATE_DATE,
		      A.COUNT,
		      A.STATUS,
		      A.ACCOMPANY_PEOPLE
		ORDER
		   BY
		     A.ACCOMPANY_NO DESC
	</select>


</mapper>